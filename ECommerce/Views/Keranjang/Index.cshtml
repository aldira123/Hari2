@using System.Globalization
@model List<eCommerce.ViewModels.KeranjangViewModel>
@{
  ViewData["Title"] = "Home Page";
  Layout = "_CustomerHomeLayout";
  int i = 0;
}
<div class="featured-page">
  <div class="container">
    <div class="row">
      <div class="col-md-4 col-sm-12">
        <div class="section-heading">
          <div class="line-dec"></div>
          <h1>Keranjangmu</h1>
        </div>
      </div>
      <div class="col-md-8 col-sm-12">
        <div id="filters" class="button-group">
          <p>
            Segera checkout Keranjangmu, sebelum kehabisan
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">

  <table class="table">
    <thead>
      <tr class="text-nowrap">
        <th>#</th>
        <th>Id Produk</th>
        <th>Gambar</th>
        <th>Jumlah</th>
        <th>SubTotal</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      @foreach (var item in Model)
      {
        i++;
        <tr>
          <td>@i</td>
          <td>@item.IdProduk</td>
          <td> <img src="~/@item.Image" height="100" /></td>
          <form asp-controller="Keranjang" asp-action="Edit" method="post">
            <td>
              <input type="hidden" name="IdProduk" value="@item.IdProduk" />
              @* <input type="hidden" name="Harga" value="@item.HargaBarang" />  *@
              <input type="number" name="JumlahBarang" value="@item.JumlahBarang" />
            </td>
            <td>@item.Subtotal.ToString("C", new CultureInfo("id-ID"))</td>
            <td>
              <button type="submit">Update</button>
            </td>
          </form>
          <td><a asp-action="Delete" asp-route-id="@item.IdKeranjang" class="btn btn-sm btn-primary">Delete</a></td>
        </tr>
      }
    </tbody>
  </table>
  <form asp-controller="Order" asp-action="Checkout">
    @foreach (var item in Model)
    {
      <input type="hidden" name="Id" value="@item.IdKeranjang" />
      <input type="hidden" name="Qty" value="@item.JumlahBarang" />
    }
    <label>Pilih Alamat Pengiriman</label>
    <select name="Alamat" asp-items="@ViewBag.AlamatDataSource"></select>
    <br />
    <button type="submit">Checkout</button>
  </form>
</div>

</div>
</section>

@*
  @section Scripts {
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script type="text/javascript">
  $(document).ready(function () {
  $("input[name='Qty']").on('change', function (e) {
  let qty = $(this).val(),
  harga = $(this).siblings("input[name='Harga']").val();
  let id = $(this).siblings("input[name='Id']").val(),
  base = $(this);
  $.ajax({
  url: "/Keranjang/Edit",
  type: "post",
  data: { IdKeranjang: id, JumlahBarang: qty },
  dataType: "json",
  success: function (response) {
  if (response.success) {
  console.log(response.message);
  base.parent().siblings(".sub-tot").text(`Rp.${hitung(harga, qty)}`);
  } else {
  console.log(response.message);
  }
  }
  })
  })
  const hitung = (harga, qty) => {
  let total = parseFloat(harga) * parseFloat(qty);
  var abc = new Intl.NumberFormat(['ban', 'id']).format(total);
  return abc;
  }
  });
  </script>
  } *@